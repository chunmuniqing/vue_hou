(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-60c0c5cb"],{"5a0a":function(e,t,s){},"7e58":function(e,t,s){"use strict";s.r(t),s("d9e2"),s("ac1f"),s("00b4"),s("d3b7");var a={name:"User",data:function(){return{queryInfo:{query:"",pagenum:1,pagesize:2},total:0,userList:[],userLoading:!1,swaitchBtn:!1,addUserDialog:!1,addUserForm:{username:"",password:"",email:"",mobile:""},addUserRules:{username:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:1,max:8,message:"长度在 1 到 8 个字符",trigger:"blur"}],password:[{required:!0,validator:function(e,t,s){""===t?s(new Error("请输入密码")):/^[\w_]{6,16}$/.test(t)?s():s(new Error("密码需为6-16位的数字大小写字母或下划线"))},trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"}]},disUsername:!1,isShowPassword:!0,editUserForm:{},setRoleDialogVisible:!1,userInfo:{},newRole:"",newRoleList:[]}},methods:{getUserList:function(){var e=this;this.userLoading=!0,this.$api.home.getUser(this.queryInfo).then((function(t){200===t.meta.status?(e.total=t.data.total,e.userList=t.data.users):e.$message.error(t.meta.msg)})).finally((function(){e.userLoading=!1}))},handleSizeChange:function(e){this.queryInfo.pagesize=e,this.getUserList()},handleCurrentChange:function(e){this.queryInfo.pagenum=e,this.getUserList()},switchBtn:function(e){var t=this;this.swaitchBtn=!0,this.$api.home.getSwitchBtn({uId:1*e.id,type:e.mg_state}).then((function(s){if(200!==s.meta.status)return e.mg_state=!e.mg_state,t.$message.error(s.meta.msg)})).finally((function(){t.swaitchBtn=!1}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.isShowPassword?t.$api.home.getAddUser(t.addUserForm).then((function(e){if(201!==e.meta.status)return t.$message.error(e.meta.msg);setTimeout((function(){t.getUserList(),t.$message.success("添加用户成功")}),0)})).finally((function(){t.addUserDialog=!1})):t.$api.home.getEditUser(t.addUserForm).then((function(e){if(200!==e.meta.status)return t.$message.error(e.meta.msg);setTimeout((function(){t.getUserList(),t.$message.success("修改用户成功")}),0)})).finally((function(){t.addUserDialog=!1}))}))},closeAddUser:function(){this.addUserForm={username:"",password:"",email:"",mobile:""},this.$refs.addUserForm.resetFields()},openAddUser:function(e){var t=this;"add"===e?(this.disUsername=!1,this.isShowPassword=!0):(this.isShowPassword=!1,this.disUsername=!0,this.$api.home.getUserId(e.id).then((function(e){200!==e.meta.status&&t.$message.error(e.meta.msg),t.addUserForm=e.data}))),this.addUserDialog=!0},delUser:function(e){var t=this;this.$confirm("此操作将删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$api.home.getDelUser(e).then((function(e){if(200!==e.meta.status)return t.$message.error(e.meta.msg);var s=Math.ceil((t.total-1)/t.queryInfo.pagesize),a=t.queryInfo.pagenum>s?s:t.queryInfo.pagenum;t.queryInfo.pagenum=a<1?1:a,t.getUserList(),t.$message({type:"success",message:"删除成功!"})}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},saveRoleInfo:function(){var e=this;this.newRole&&this.$api.home.getAssignRoles(this.userInfo.id,this.newRole).then((function(t){e.$fn.error(t)&&(e.$message.success(t.meta.msg),e.getUserList(),e.setRoleDialogVisible=!1)}))},setRoleDialogClosed:function(){this.newRole=""},openRole:function(e){var t=this;this.userInfo=e,this.$api.rights.getAllRoles().then((function(e){t.$fn.error(e),t.newRoleList=e.data})),this.setRoleDialogVisible=!0}},created:function(){this.getUserList()}},r=(s("9b12"),s("2877")),i=Object(r.a)(a,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),s("el-breadcrumb-item",[e._v("用户管理")]),s("el-breadcrumb-item",[e._v("用户列表")])],1),s("el-card",{staticClass:"box-card"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:10}},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.getUserList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getUserList},slot:"append"})],1)],1),s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.openAddUser("add")}}},[e._v("添加用户")])],1)],1),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.userList,border:""}},[s("el-table-column",{attrs:{label:"#",type:"index",width:"50",align:"center"}}),s("el-table-column",{attrs:{prop:"username",label:"用户名"}}),s("el-table-column",{attrs:{prop:"mobile",label:"电话"}}),s("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),s("el-table-column",{attrs:{prop:"role_name",label:"角色"}}),s("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949",disabled:e.swaitchBtn},on:{change:function(t){return e.switchBtn(a)}},model:{value:a.mg_state,callback:function(t){e.$set(a,"mg_state",t)},expression:"row.mg_state"}})]}}])}),s("el-table-column",{attrs:{prop:"address",label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[s("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(t){return e.openAddUser(a)}}}),s("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(t){return e.delUser(a)}}}),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分配角色",placement:"top-start",enterable:!1}},[s("el-button",{attrs:{icon:"el-icon-setting",size:"mini",type:"warning"},on:{click:function(t){return e.openRole(a)}}})],1)]}}])})],1),s("el-pagination",{attrs:{"current-page":e.queryInfo.pagenum,"page-sizes":[2,4,6,8],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),s("el-dialog",{attrs:{title:"添加用户",visible:e.addUserDialog,width:"50%"},on:{"update:visible":function(t){e.addUserDialog=t},close:e.closeAddUser}},[s("el-form",{ref:"addUserForm",attrs:{model:e.addUserForm,rules:e.addUserRules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"用户名",prop:e.isShowPassword?"username":""}},[s("el-input",{attrs:{disabled:e.disUsername},model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),e.isShowPassword?s("el-form-item",{attrs:{label:"密码",prop:"password"}},[s("el-input",{model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1):e._e(),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1),s("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[s("el-input",{model:{value:e.addUserForm.mobile,callback:function(t){e.$set(e.addUserForm,"mobile",t)},expression:"addUserForm.mobile"}})],1),s("el-form-item",{attrs:{align:"right"}},[s("el-button",{on:{click:function(t){e.addUserDialog=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("addUserForm")}}},[e._v("确 定")])],1)],1)],1),s("el-dialog",{attrs:{visible:e.setRoleDialogVisible,title:"分配角色",width:"35%"},on:{"update:visible":function(t){e.setRoleDialogVisible=t},close:e.setRoleDialogClosed}},[s("div",[s("p",[e._v("当前的用户: "+e._s(e.userInfo.username))]),s("p",[e._v("当前的角色: "+e._s(e.userInfo.role_name))]),s("p",[e._v("分配新角色: "),s("el-select",{attrs:{clearable:"",placeholder:"请选择",size:"small"},model:{value:e.newRole,callback:function(t){e.newRole=t},expression:"newRole"}},e._l(e.newRoleList,(function(e){return s("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})})),1)],1)]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.setRoleDialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveRoleInfo()}}},[e._v("确 定")])],1)])],1)}),[],!1,null,"b45d77b6",null);t.default=i.exports},"9b12":function(e,t,s){"use strict";s("5a0a")}}]);