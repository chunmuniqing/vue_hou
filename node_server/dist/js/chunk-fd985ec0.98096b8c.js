(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-fd985ec0"],{"3fb2":function(t,e,a){},"656d":function(t,e,a){"use strict";a.r(e),a("d3b7"),a("159b"),a("ac1f"),a("1276"),a("a434"),a("498a"),a("a15b");var i=(a("dded"),a("2877")),n=Object(i.a)({name:"Params",data:function(){return{selectedKeys:[],cateList:[],cateProps:{label:"cat_name",value:"cat_id",children:"children"},activeName:"many",manyData:[],onlyData:[],addDialogVisible:!1,addForm:{attr_name:""},addFormRules:{attr_name:[{require:!0,message:"请输入参数名称",trigger:"blur"}]},editDialogVisible:!1,editForm:{attr_name:""},editFormRules:{attr_name:[{required:!0,message:"请输入参数名称",trigger:"blur"}]},editData:{}}},methods:{handleChange:function(t){if(3!==t.length)return this.selectedKeys=[],this.manyData=[],void(this.onlyData=[]);this.selectGoodsData()},categoriesList:function(){var t=this;this.$api.shop.goCategoriesList().then((function(e){t.$fn.error&&(t.cateList=e.data)}))},handleClick:function(){3===this.selectedKeys.length&&this.selectGoodsData()},selectGoodsData:function(){var t=this;this.$api.shop.getAttributes({id:this.getCateId,sel:this.activeName}).then((function(e){t.$fn.error&&(e.data.forEach((function(t){t.attr_vals=t.attr_vals?t.attr_vals.split(","):[],t.inputVisible=!1,t.inputValue=""})),"many"===t.activeName?t.manyData=e.data:"only"===t.activeName&&(t.onlyData=e.data))}))},addDialogClosed:function(){this.$refs.addForm.resetFields()},addParams:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;var a={attr_name:e.addForm.attr_name,cat_id:e.getCateId,attr_sel:e.activeName};e.$api.shop.getAddAttribute(a).then((function(t){e.$fn.error&&(e.$message.success(t.meta.msg),e.selectGoodsData(),e.addDialogVisible=!1)}))}))},editAttribute:function(t){var e=this;this.$api.shop.getEditAttribute({id:this.getCateId,attrId:t,attr_sel:this.activeName}).then((function(t){e.$fn.error&&(e.editForm=t.data)})),this.editDialogVisible=!0},editDialogClosed:function(){this.$refs.editForm.resetFields()},editParams:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return!1;e.$api.shop.editAttribute(e.editForm).then((function(t){e.$fn.error&&(e.$message.success(t.meta.msg),e.selectGoodsData(),e.editDialogVisible=!1)}))}))},delAttribute:function(t){var e=this;this.$confirm("此操作将删除该商品参数, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$api.shop.delAttribute(t).then((function(t){if(200!==t.meta.status)return e.$message.error(t.meta.msg);e.selectGoodsData(),e.$message({type:"success",message:"删除成功!"})}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},handleClose:function(t,e){var a=this;this.$confirm("此操作将删除该参数, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.attr_vals.splice(e,1),a.saveAttrVals(t,!0)})).catch((function(){a.$message({type:"info",message:"已取消删除"})}))},showInput:function(t){var e=this;t.inputVisible=!0,this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(t){if(0===t.inputValue.trim().length)return t.inputVisible=!1,void(t.inputValue="");t.attr_vals.push(t.inputValue.trim()),this.saveAttrVals(t)},saveAttrVals:function(t,e){var a=this;this.$api.shop.editOneAttribute({id:this.getCateId,attrId:t.attr_id,attr_name:t.attr_name,attr_sel:t.attr_sel,attr_vals:t.attr_vals.join()}).then((function(i){a.$fn.error&&(t.inputVisible=!1,t.inputValue="",e&&a.$message.success("删除成功"))}))}},mounted:function(){this.categoriesList()},computed:{isBtnDisabled:function(){return 3!==this.selectedKeys.length},getCateId:function(){return 3===this.selectedKeys.length?this.selectedKeys[this.selectedKeys.length-1]:null},titleText:function(){return"many"===this.activeName?"动态参数":"only"===this.activeName?"静态属性":void 0}}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[t._v("首页")]),a("el-breadcrumb-item",[t._v("商品管理")]),a("el-breadcrumb-item",[t._v("分类参数")])],1),a("el-card",[a("el-alert",{attrs:{title:"注意: 只允许为三级分类设置相关参数!",type:"warning","show-icon":"",closable:!1}}),a("el-row",{staticClass:"cat_opt"},[a("el-col",[a("span",[t._v("选择商品分类: ")]),a("el-cascader",{attrs:{size:"small",options:t.cateList,props:t.cateProps,clearable:""},on:{change:t.handleChange},model:{value:t.selectedKeys,callback:function(e){t.selectedKeys=e},expression:"selectedKeys"}})],1)],1),a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"动态参数",name:"many"}},[a("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{size:"mini",type:"primary",disabled:t.isBtnDisabled},on:{click:function(e){t.addDialogVisible=!0}}},[t._v("添加参数 ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.manyData,border:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[t._l(i.attr_vals,(function(e,n){return a("el-tag",{key:n,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.handleClose(i,n)}}},[t._v(" "+t._s(e)+" ")])})),i.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(e){return t.handleInputConfirm(i)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(i)}},model:{value:i.inputValue,callback:function(e){t.$set(i,"inputValue",e)},expression:"row.inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(e){return t.showInput(i)}}},[t._v("+ New Tag")])]}}])}),a("el-table-column",{attrs:{type:"index",label:"#",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"attr_name",label:"参数名称"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(e){return t.editAttribute(i.attr_id)}}},[t._v("编辑 ")]),a("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(e){return t.delAttribute(i)}}},[t._v("删除 ")])]}}])})],1)],1),a("el-tab-pane",{attrs:{label:"静态属性",name:"only"}},[a("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{size:"mini",type:"primary",disabled:t.isBtnDisabled},on:{click:function(e){t.addDialogVisible=!0}}},[t._v("添加属性 ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.onlyData,border:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[t._l(i.attr_vals,(function(e,n){return a("el-tag",{key:n,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.handleClose(i,n)}}},[t._v(" "+t._s(e)+" ")])})),i.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(e){return t.handleInputConfirm(i)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(i)}},model:{value:i.inputValue,callback:function(e){t.$set(i,"inputValue",e)},expression:"row.inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(e){return t.showInput(i)}}},[t._v("+ New Tag")])]}}])}),a("el-table-column",{attrs:{type:"index",label:"#",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"attr_name",label:"参数名称"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(e){return t.editAttribute(i.attr_id)}}},[t._v("编辑 ")]),a("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(e){return t.delAttribute(i)}}},[t._v("删除 ")])]}}])})],1)],1)],1)],1),a("el-dialog",{attrs:{title:"添加"+t.titleText,visible:t.addDialogVisible,width:"35%"},on:{"update:visible":function(e){t.addDialogVisible=e},close:t.addDialogClosed}},[a("el-form",{ref:"addForm",attrs:{model:t.addForm,"label-width":"100px",rules:t.addFormRules,"label-suffix":":"}},[a("el-form-item",{attrs:{prop:"attr_name",label:t.titleText}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.addForm.attr_name,callback:function(e){t.$set(t.addForm,"attr_name",e)},expression:"addForm.attr_name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addParams("addForm")}}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"修改"+t.titleText,visible:t.editDialogVisible,width:"35%"},on:{"update:visible":function(e){t.editDialogVisible=e},close:t.editDialogClosed}},[a("el-form",{ref:"editForm",attrs:{model:t.editForm,"label-width":"100px",rules:t.editFormRules,"label-suffix":":"}},[a("el-form-item",{attrs:{prop:"attr_name",label:t.titleText}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.editForm.attr_name,callback:function(e){t.$set(t.editForm,"attr_name",e)},expression:"editForm.attr_name"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.editDialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.editParams("editForm")}}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,"9032cf4a",null);e.default=n.exports},dded:function(t,e,a){"use strict";a("3fb2")}}]);