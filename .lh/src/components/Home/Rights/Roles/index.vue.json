{
    "sourceFile": "src/components/Home/Rights/Roles/index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1644764699296,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1644764746554,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n         border\r\n         stripe\r\n         v-loading=\"!rolesList.length\"\r\n         element-loading-text=\"数据加载中...\"\r\n-         row-key=\"id\"\r\n+       \r\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n"
                },
                {
                    "date": 1644764818508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n-              v-for=\"(item, i1) in row.children\"\r\n+              v-for=\"((item), i1) in row.children\"\r\n               :key=\"item.id\"\r\n               :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n             >\r\n               <el-col :span=\"5\"\r\n"
                },
                {
                    "date": 1644764824770,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,10 @@\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n-              v-for=\"((item), i1) in row.children\"\r\n-              :key=\"item.id\"\r\n+              v-for=\"((item,index), i1) in row.children\"\r\n+              :key=\"index\"\r\n               :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n             >\r\n               <el-col :span=\"5\"\r\n                 ><el-tag\r\n"
                },
                {
                    "date": 1644764832817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,10 +23,10 @@\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n-              v-for=\"((item,index), i1) in row.children\"\r\n-              :key=\"index\"\r\n+              v-for=\"(item, i1) in row.children\"\r\n+              :key=\"item.id\"\r\n               :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n             >\r\n               <el-col :span=\"5\"\r\n                 ><el-tag\r\n"
                },
                {
                    "date": 1644764877610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,9 +38,9 @@\n               ></el-col>\r\n               <el-col :span=\"19\">\r\n                 <el-row\r\n                   v-for=\"(item2, i2) in item.children\"\r\n-                  :key=\"item2.id\"\r\n+                  :key=\"i2\"\r\n                   :class=\"[i2 === 0 ? '' : 'bdtop', 'vcenter']\"\r\n                 >\r\n                   <el-col :span=\"6\">\r\n                     <el-tag\r\n"
                },
                {
                    "date": 1644764885401,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,9 +55,9 @@\n                     <el-tag\r\n                       class=\"one-tag\"\r\n                       type=\"warning\"\r\n                       v-for=\"(item3, i3) in item2.children\"\r\n-                      :key=\"item3.id\"\r\n+                      :key=\"i3\"\r\n                       closable\r\n                       @close=\"removeByRights(row, item3.id)\"\r\n                       >{{ item3.authName }}</el-tag\r\n                     ></el-col\r\n"
                },
                {
                    "date": 1644764892076,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n               v-for=\"(item, i1) in row.children\"\r\n-              :key=\"item.id\"\r\n+              :key=\"i1\"\r\n               :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n             >\r\n               <el-col :span=\"5\"\r\n                 ><el-tag\r\n"
                },
                {
                    "date": 1644764933287,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n               v-for=\"(item, i1) in row.children\"\r\n-              :key=\"i1\"\r\n+              :key=\"item.id\"\r\n               :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n             >\r\n               <el-col :span=\"5\"\r\n                 ><el-tag\r\n"
                },
                {
                    "date": 1644764945965,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,9 +38,9 @@\n               ></el-col>\r\n               <el-col :span=\"19\">\r\n                 <el-row\r\n                   v-for=\"(item2, i2) in item.children\"\r\n-                  :key=\"i2\"\r\n+                  :key=\"item2.id\"\r\n                   :class=\"[i2 === 0 ? '' : 'bdtop', 'vcenter']\"\r\n                 >\r\n                   <el-col :span=\"6\">\r\n                     <el-tag\r\n"
                },
                {
                    "date": 1644764961373,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,9 +55,9 @@\n                     <el-tag\r\n                       class=\"one-tag\"\r\n                       type=\"warning\"\r\n                       v-for=\"(item3, i3) in item2.children\"\r\n-                      :key=\"i3\"\r\n+                      :key=\"item3.id\"\r\n                       closable\r\n                       @close=\"removeByRights(row, item3.id)\"\r\n                       >{{ item3.authName }}</el-tag\r\n                     ></el-col\r\n"
                },
                {
                    "date": 1644764990194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n         border\r\n         stripe\r\n         v-loading=\"!rolesList.length\"\r\n         element-loading-text=\"数据加载中...\"\r\n-       \r\n+         row-key=\"id\"\r\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n"
                },
                {
                    "date": 1644764996857,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,8 @@\n         border\r\n         stripe\r\n         v-loading=\"!rolesList.length\"\r\n         element-loading-text=\"数据加载中...\"\r\n-         row-key=\"id\"\r\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n"
                },
                {
                    "date": 1644765029923,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,9 @@\n         border\r\n         stripe\r\n         v-loading=\"!rolesList.length\"\r\n         element-loading-text=\"数据加载中...\"\r\n+        row\r\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n"
                },
                {
                    "date": 1644765047777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,8 @@\n         border\r\n         stripe\r\n         v-loading=\"!rolesList.length\"\r\n         element-loading-text=\"数据加载中...\"\r\n-        row\r\n       >\r\n         <el-table-column type=\"expand\">\r\n           <template v-slot=\"{ row }\">\r\n             <el-row\r\n"
                }
            ],
            "date": 1644764699296,
            "name": "Commit-0",
            "content": "<template>\r\n  <div>\r\n    <!--面包屑导航区域-->\r\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n      <el-breadcrumb-item :to=\"{ path: '/home' }\">首页</el-breadcrumb-item>\r\n      <el-breadcrumb-item>权限管理</el-breadcrumb-item>\r\n      <el-breadcrumb-item>角色列表</el-breadcrumb-item>\r\n    </el-breadcrumb>\r\n    <el-card>\r\n      <el-row class=\"add-roles-btn\">\r\n        <el-col>\r\n          <el-button type=\"primary\">添加角色</el-button>\r\n        </el-col>\r\n      </el-row>\r\n      <el-table\r\n        :data=\"rolesList\"\r\n        style=\"width: 100%\"\r\n        border\r\n        stripe\r\n        v-loading=\"!rolesList.length\"\r\n        element-loading-text=\"数据加载中...\"\r\n         row-key=\"id\"\r\n      >\r\n        <el-table-column type=\"expand\">\r\n          <template v-slot=\"{ row }\">\r\n            <el-row\r\n              v-for=\"(item, i1) in row.children\"\r\n              :key=\"item.id\"\r\n              :class=\"['bdbottom', i1 === 0 ? 'bdtop' : '', 'vcenter']\"\r\n            >\r\n              <el-col :span=\"5\"\r\n                ><el-tag\r\n                  class=\"one-tag\"\r\n                  closable\r\n                  @close=\"removeByRights(row, item.id)\"\r\n                  >{{ item.authName }}</el-tag\r\n                ><i class=\"el-icon-caret-right\"></i\r\n              ></el-col>\r\n              <el-col :span=\"19\">\r\n                <el-row\r\n                  v-for=\"(item2, i2) in item.children\"\r\n                  :key=\"item2.id\"\r\n                  :class=\"[i2 === 0 ? '' : 'bdtop', 'vcenter']\"\r\n                >\r\n                  <el-col :span=\"6\">\r\n                    <el-tag\r\n                      class=\"one-tag\"\r\n                      type=\"success\"\r\n                      closable\r\n                      @close=\"removeByRights(row, item2.id)\"\r\n                      >{{ item2.authName }}</el-tag\r\n                    ><i class=\"el-icon-caret-right\"></i>\r\n                  </el-col>\r\n                  <el-col :span=\"18\">\r\n                    <el-tag\r\n                      class=\"one-tag\"\r\n                      type=\"warning\"\r\n                      v-for=\"(item3, i3) in item2.children\"\r\n                      :key=\"item3.id\"\r\n                      closable\r\n                      @close=\"removeByRights(row, item3.id)\"\r\n                      >{{ item3.authName }}</el-tag\r\n                    ></el-col\r\n                  >\r\n                </el-row>\r\n              </el-col>\r\n            </el-row>\r\n          </template>\r\n        </el-table-column>\r\n        <!-- 索引列 -->\r\n        <el-table-column label=\"#\" type=\"index\"> </el-table-column>\r\n        <el-table-column label=\"角色名称\" prop=\"roleName\"> </el-table-column>\r\n        <el-table-column label=\"角色描述\" prop=\"roleDesc\"> </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"300px\" align=\"center\">\r\n          <template v-slot=\"{ row }\">\r\n            <el-button icon=\"el-icon-edit\" size=\"mini\" type=\"primary\"\r\n              >编辑\r\n            </el-button>\r\n            <el-button icon=\"el-icon-delete\" size=\"mini\" type=\"danger\"\r\n              >删除\r\n            </el-button>\r\n\r\n            <el-button\r\n              icon=\"el-icon-setting\"\r\n              size=\"mini\"\r\n              type=\"warning\"\r\n              @click=\"showSetRightDialog(row)\"\r\n              >分配权限\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n    <el-dialog\r\n      :visible.sync=\"setRightDialogVisible\"\r\n      title=\"分配权限\"\r\n      width=\"50%\"\r\n      @close=\"clearRoles\"\r\n    >\r\n      <el-tree\r\n        :data=\"roleTreeList\"\r\n        :props=\"defaultProps\"\r\n        show-checkbox\r\n        node-key=\"id\"\r\n        default-expand-all\r\n        :default-checked-keys=\"defKeys\"\r\n        ref=\"treeRef\"\r\n      ></el-tree>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"setRightDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"allotRights()\">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'Roles',\r\n  data() {\r\n    return {\r\n      rolesList: [],\r\n      setRightDialogVisible: false,\r\n      roleTreeList: [],\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'authName'\r\n      },\r\n      defKeys: [],\r\n      roleId: ''\r\n    }\r\n  },\r\n  methods: {\r\n    allRolesList() {\r\n      this.$api.rights.getAllRoles().then((res) => {\r\n        if (res.meta.status !== 200) {\r\n          return this.$messsage.error(res.meta.msg)\r\n        }\r\n        this.rolesList = res.data\r\n        console.log(this.rolesList, 111)\r\n      })\r\n    },\r\n    removeByRights(row, id) {\r\n      this.$confirm('确定删除此角色权限, 是否继续?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      })\r\n        .then(() => {\r\n          console.log(row, 111, id)\r\n          this.$api.rights.getDelRoles(row, id).then((res) => {\r\n            if (res.meta.status !== 200) {\r\n              return this.$message.error(this.meta.msg)\r\n            }\r\n            row.children = res.data\r\n            // this.allRolesList()\r\n          })\r\n          this.$message({\r\n            type: 'success',\r\n            message: '删除成功!'\r\n          })\r\n        })\r\n        .catch((err) => console.log(err))\r\n    },\r\n    showSetRightDialog(row) {\r\n      this.roleId = row.id\r\n      this.$api.rights.getAllRights('tree').then((res) => {\r\n        this.$fn.error(res)\r\n\r\n        this.roleTreeList = res.data\r\n        this.getThreeId(row, this.defKeys)\r\n        // console.log(this.defKeys)\r\n        this.setRightDialogVisible = true\r\n      })\r\n    },\r\n    allotRights() {\r\n      const keys = [\r\n        ...this.$refs.treeRef.getCheckedKeys(),\r\n        ...this.$refs.treeRef.getHalfCheckedKeys()\r\n      ]\r\n      this.$api.rights\r\n        .getRoleRights(this.roleId, keys.join(','))\r\n        .then((res) => {\r\n          this.$fn.error(res)\r\n          console.log(res, 222)\r\n          this.allRolesList()\r\n          this.setRightDialogVisible = false\r\n        })\r\n    },\r\n    // 获取树型3级列表的id\r\n    getThreeId(node, arr) {\r\n      if (!node.children) {\r\n        return arr.push(node.id)\r\n      }\r\n      node.children.forEach((item) => {\r\n        this.getThreeId(item, arr)\r\n      })\r\n    },\r\n    clearRoles() {\r\n      this.defKeys = []\r\n    }\r\n  },\r\n  mounted() {\r\n    this.allRolesList()\r\n  }\r\n}\r\n</script>\r\n\r\n<style  scoped>\r\n.add-roles-btn {\r\n  margin-bottom: 20px;\r\n}\r\n.one-tag {\r\n  margin: 7px;\r\n}\r\n.bdtop {\r\n  border-top: 1px solid #eee;\r\n}\r\n.bdbottom {\r\n  border-bottom: 1px solid #eee;\r\n}\r\n*/deep/ td.el-table__cell.el-table__expanded-cell {\r\n  padding: 20px 40px;\r\n}\r\n.vcenter {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n</style>\r\n"
        }
    ]
}